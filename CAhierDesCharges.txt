Cahier des charges dÃ©taillÃ© - Assistant IA Email Outlook
ğŸ¯ Objectif du projet

DÃ©velopper un Add-in Outlook avec assistant IA pour gÃ©nÃ©rer des rÃ©ponses automatiques basÃ©es sur une base de connaissances (RAG), en utilisant uniquement des solutions open-source et gratuites.

ğŸ—ï¸ Architecture technique (100% gratuite)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    OUTLOOK ADD-IN (Frontend)                â”‚
â”‚  Technologies: HTML5, CSS3, Vanilla JavaScript, Office.js   â”‚
â”‚  - Bouton dans le ruban Outlook                             â”‚
â”‚  - Panneau latÃ©ral (Task Pane)                              â”‚
â”‚  - Interface de validation/modification                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“ HTTPS
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              BACKEND API (Serveur entreprise)               â”‚
â”‚  Technologies: Node.js + Express                            â”‚
â”‚  Port: 3000 (interne) ou via reverse proxy Nginx           â”‚
â”‚                                                             â”‚
â”‚  Endpoints:                                                 â”‚
â”‚  POST /api/generate-response    â†’ GÃ©nÃ¨re rÃ©ponse IA        â”‚
â”‚  POST /api/add-document         â†’ Ajoute doc Ã  la base     â”‚
â”‚  GET  /api/health               â†’ Check santÃ© serveur      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    OLLAMA (LLM local)                       â”‚
â”‚  ModÃ¨le: llama3.2:3b (lÃ©ger) ou mistral:7b                 â”‚
â”‚  Port: 11434                                                â”‚
â”‚  MÃ©moire requise: 8GB RAM minimum                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              RAG - Base de connaissances                    â”‚
â”‚  Vector DB: Qdrant (gratuit, self-hosted)                  â”‚
â”‚  Embeddings: sentence-transformers (all-MiniLM-L6-v2)      â”‚
â”‚  Stockage: PostgreSQL + pgvector (ou SQLite pour test)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ“¦ Stack technique dÃ©taillÃ©e (Alternatives gratuites)
ComposantSolution payanteAlternative gratuiteJustificationLLMClaude API ($)Ollama + Llama 3.2Self-hosted, aucun coÃ»tVector DBPinecone ($)QdrantOpen-source, self-hostedEmbeddingsOpenAI ($)all-MiniLM-L6-v2Gratuit, performantHosting APIAzure ($)Serveur entrepriseInfrastructure existanteDatabaseMongoDB Atlas ($)PostgreSQL + pgvectorOpen-source, robusteReverse Proxy-NginxGratuit, standard industrie

ğŸ“ SpÃ©cifications fonctionnelles
1. FonctionnalitÃ©s principales
âœ… Phase 1 : MVP (Minimum Viable Product)

F1.1 : Bouton "ğŸ¤– RÃ©ponse IA" dans le ruban Outlook
F1.2 : RÃ©cupÃ©ration automatique du contenu de l'email (expÃ©diteur, sujet, corps)
F1.3 : Analyse de l'intention de l'email (question, rÃ©clamation, demande d'info)
F1.4 : Recherche dans la base de connaissances (RAG)
F1.5 : GÃ©nÃ©ration d'une rÃ©ponse avec Ollama (Llama 3.2)
F1.6 : Affichage de la rÃ©ponse avec score de confiance
F1.7 : Boutons : [Modifier] [Utiliser] [RÃ©gÃ©nÃ©rer]
F1.8 : Insertion de la rÃ©ponse dans l'Ã©diteur Outlook

ğŸš€ Phase 2 : AmÃ©liorations (optionnel)

F2.1 : Historique des rÃ©ponses gÃ©nÃ©rÃ©es
F2.2 : Feedback utilisateur (ğŸ‘ğŸ‘) pour amÃ©liorer le modÃ¨le
F2.3 : Suggestions de piÃ¨ces jointes basÃ©es sur le contexte
F2.4 : Mode "Brouillon automatique" (gÃ©nÃ©ration en arriÃ¨re-plan)


ğŸ› ï¸ Instructions dÃ©taillÃ©es pour Claude Code Sonnet 4.5

ğŸ“¦ PARTIE 1 : INSTALLATION DES DÃ‰PENDANCES (Serveur entreprise)
Prompt pour Claude Code :
Je vais crÃ©er un assistant IA pour Outlook. Voici les Ã©tapes d'installation sur un serveur Linux (Ubuntu 22.04).

TÃ‚CHE 1 : CrÃ©e un script bash "install-server.sh" qui :

1. Installe Node.js 20 LTS
2. Installe PostgreSQL 15 avec l'extension pgvector
3. Installe Ollama
4. TÃ©lÃ©charge le modÃ¨le Llama 3.2 (3B)
5. Installe Qdrant via Docker
6. Installe Nginx
7. CrÃ©e les rÃ©pertoires nÃ©cessaires :
   - /opt/outlook-ai-assistant/backend
   - /opt/outlook-ai-assistant/data/knowledge-base
   - /opt/outlook-ai-assistant/logs

Ajoute des messages de progression et gÃ¨re les erreurs.
Le script doit Ãªtre exÃ©cutable avec : sudo bash install-server.sh
Fichier attendu : install-server.sh

ğŸ“¦ PARTIE 2 : BACKEND API (Node.js)
Prompt pour Claude Code :
TÃ‚CHE 2 : CrÃ©e un backend Node.js professionnel pour l'assistant IA email.

STRUCTURE DU PROJET :
outlook-ai-backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ server.js                    # Point d'entrÃ©e
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ database.js              # Config PostgreSQL
â”‚   â”‚   â”œâ”€â”€ ollama.js                # Config Ollama
â”‚   â”‚   â””â”€â”€ qdrant.js                # Config Qdrant
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ email.routes.js          # Routes emails
â”‚   â”‚   â””â”€â”€ knowledge.routes.js      # Routes gestion docs
â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”œâ”€â”€ email.controller.js      # Logique emails
â”‚   â”‚   â””â”€â”€ knowledge.controller.js  # Logique RAG
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ rag.service.js           # Service RAG
â”‚   â”‚   â”œâ”€â”€ llm.service.js           # Service Ollama
â”‚   â”‚   â”œâ”€â”€ embedding.service.js     # GÃ©nÃ©ration embeddings
â”‚   â”‚   â””â”€â”€ email-parser.service.js  # Analyse emails
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ email.model.js           # ModÃ¨le email
â”‚   â”‚   â””â”€â”€ document.model.js        # ModÃ¨le document
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ logger.js                # Logs Winston
â”‚   â”‚   â”œâ”€â”€ validation.js            # Validation Joi
â”‚   â”‚   â””â”€â”€ errors.js                # Gestion erreurs
â”‚   â””â”€â”€ middleware/
â”‚       â”œâ”€â”€ auth.middleware.js       # Authentification
â”‚       â”œâ”€â”€ cors.middleware.js       # CORS
â”‚       â””â”€â”€ rate-limit.middleware.js # Rate limiting
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ unit/
â”‚   â””â”€â”€ integration/
â”œâ”€â”€ .env.example
â”œâ”€â”€ .gitignore
â”œâ”€â”€ package.json
â”œâ”€â”€ README.md
â””â”€â”€ ecosystem.config.js              # Config PM2

DÃ‰PENDANCES :
{
  "dependencies": {
    "express": "^4.18.2",
    "dotenv": "^16.3.1",
    "pg": "^8.11.3",
    "pgvector": "^0.1.5",
    "ollama": "^0.5.0",
    "@qdrant/js-client-rest": "^1.8.0",
    "winston": "^3.11.0",
    "joi": "^17.11.0",
    "helmet": "^7.1.0",
    "express-rate-limit": "^7.1.5",
    "cors": "^2.8.5",
    "multer": "^1.4.5-lts.1",
    "pdf-parse": "^1.1.1",
    "mammoth": "^1.6.0",
    "@xenova/transformers": "^2.10.0"
  },
  "devDependencies": {
    "nodemon": "^3.0.2",
    "jest": "^29.7.0",
    "supertest": "^6.3.3"
  }
}

SPÃ‰CIFICATIONS DÃ‰TAILLÃ‰ES :

1. server.js :
   - Ã‰coute sur le port 3000
   - Middleware : helmet, cors, rate-limit, express.json
   - Gestion globale des erreurs
   - Graceful shutdown

2. email.controller.js :
   Endpoint : POST /api/generate-response
   Input : { subject: string, body: string, from: string }
   Processus :
   a) Parser l'email (extraire intention, entitÃ©s)
   b) GÃ©nÃ©rer embedding du contexte
   c) Rechercher dans Qdrant (top 5 rÃ©sultats)
   d) Construire le prompt avec contexte RAG
   e) Appeler Ollama pour gÃ©nÃ©rer la rÃ©ponse
   f) Calculer score de confiance (0-100)
   Output : {
     response: string,
     confidence: number,
     sources: [{ title: string, excerpt: string }],
     intention: string,
     processingTime: number
   }

3. rag.service.js :
   - searchSimilarDocuments(query, topK=5)
   - addDocument(content, metadata)
   - Chunking : 500 tokens avec overlap de 50

4. llm.service.js :
   - generateResponse(prompt, context)
   - ParamÃ¨tres Ollama : temperature=0.7, max_tokens=500
   - SystÃ¨me de retry (3 tentatives)

5. embedding.service.js :
   - Utilise @xenova/transformers avec "Xenova/all-MiniLM-L6-v2"
   - generateEmbedding(text) â†’ float32 array (384 dimensions)

6. Gestion des erreurs :
   - CrÃ©er des classes d'erreur custom : ValidationError, OllamaError, QdrantError
   - Middleware de gestion d'erreur global
   - Logs dÃ©taillÃ©s avec Winston (console + fichier)

7. .env.example :
PORT=3000
NODE_ENV=development
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DB=outlook_ai
POSTGRES_USER=outlook_user
POSTGRES_PASSWORD=changeme
QDRANT_URL=http://localhost:6333
OLLAMA_URL=http://localhost:11434
OLLAMA_MODEL=llama3.2:3b
LOG_LEVEL=info
MAX_CHUNK_SIZE=500
OVERLAP_SIZE=50

GÃ©nÃ¨re tous les fichiers avec du code production-ready :
- Gestion d'erreurs complÃ¨te
- Validation des inputs
- Logs dÃ©taillÃ©s
- Commentaires clairs
- Types JSDoc
Fichiers attendus : Toute la structure backend complÃ¨te

ğŸ“¦ PARTIE 3 : SYSTÃˆME RAG (Indexation des documents)
Prompt pour Claude Code :
TÃ‚CHE 3 : CrÃ©e un script d'indexation des documents pour la base de connaissances.

FICHIER : src/scripts/index-documents.js

Ce script doit :

1. Lire tous les fichiers du dossier /opt/outlook-ai-assistant/data/knowledge-base/
   Formats supportÃ©s : PDF, DOCX, TXT, MD

2. Pour chaque document :
   a) Extraire le texte (pdf-parse pour PDF, mammoth pour DOCX)
   b) Nettoyer le texte (enlever caractÃ¨res spÃ©ciaux, espaces multiples)
   c) DÃ©couper en chunks de 500 tokens avec overlap de 50 tokens
   d) GÃ©nÃ©rer les embeddings avec sentence-transformers
   e) Stocker dans Qdrant avec metadata : {
        title: nom_fichier,
        source: chemin_fichier,
        chunk_index: numÃ©ro,
        total_chunks: total,
        indexed_at: timestamp
      }
   f) Sauvegarder rÃ©fÃ©rence dans PostgreSQL

3. Afficher progression :
   - Nombre de documents traitÃ©s
   - Nombre de chunks crÃ©Ã©s
   - Temps d'exÃ©cution

4. Gestion d'erreurs :
   - Continuer si un fichier Ã©choue (log l'erreur)
   - Rollback si Qdrant ou PostgreSQL Ã©choue

Utilisation : node src/scripts/index-documents.js

Ajoute aussi un script src/scripts/clear-index.js pour vider la base.
Fichiers attendus :

src/scripts/index-documents.js
src/scripts/clear-index.js


ğŸ“¦ PARTIE 4 : OUTLOOK ADD-IN (Frontend)
Prompt pour Claude Code :
TÃ‚CHE 4 : CrÃ©e l'Add-in Outlook complet.

INITIALISATION :
npm install -g yo generator-office
yo office

Choix :
- Project type: Outlook Task Pane Add-in
- Script type: JavaScript
- Name: AI Email Assistant

STRUCTURE COMPLÃˆTE :
outlook-ai-addin/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ taskpane/
â”‚   â”‚   â”œâ”€â”€ taskpane.html
â”‚   â”‚   â”œâ”€â”€ taskpane.css
â”‚   â”‚   â”œâ”€â”€ taskpane.js
â”‚   â”‚   â””â”€â”€ components/
â”‚   â”‚       â”œâ”€â”€ loading.js
â”‚   â”‚       â”œâ”€â”€ response-display.js
â”‚   â”‚       â””â”€â”€ error-display.js
â”‚   â”œâ”€â”€ commands/
â”‚   â”‚   â”œâ”€â”€ commands.html
â”‚   â”‚   â””â”€â”€ commands.js
â”‚   â””â”€â”€ services/
â”‚       â”œâ”€â”€ api.service.js        # Communication avec backend
â”‚       â”œâ”€â”€ outlook.service.js    # Interactions Office.js
â”‚       â””â”€â”€ storage.service.js    # LocalStorage
â”œâ”€â”€ assets/
â”‚   â”œâ”€â”€ icon-16.png
â”‚   â”œâ”€â”€ icon-32.png
â”‚   â”œâ”€â”€ icon-80.png
â”‚   â””â”€â”€ logo.png
â”œâ”€â”€ manifest.xml
â”œâ”€â”€ webpack.config.js
â””â”€â”€ package.json

SPÃ‰CIFICATIONS DÃ‰TAILLÃ‰ES :

1. taskpane.html :
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assistant IA Email</title>
    <link rel="stylesheet" href="taskpane.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <img src="../../assets/logo.png" alt="Logo" class="logo">
            <h1>ğŸ¤– Assistant IA</h1>
        </header>

        <!-- Email Info -->
        <section id="emailInfo" class="email-info hidden">
            <div class="info-row">
                <span class="label">De:</span>
                <span id="emailFrom"></span>
            </div>
            <div class="info-row">
                <span class="label">Sujet:</span>
                <span id="emailSubject"></span>
            </div>
        </section>

        <!-- Loading State -->
        <section id="loading" class="loading hidden">
            <div class="spinner"></div>
            <p id="loadingText">Analyse en cours...</p>
            <div class="progress-steps">
                <div class="step" id="step1">ğŸ“§ Lecture email</div>
                <div class="step" id="step2">ğŸ” Recherche contexte</div>
                <div class="step" id="step3">ğŸ¤– GÃ©nÃ©ration rÃ©ponse</div>
            </div>
        </section>

        <!-- Error State -->
        <section id="error" class="error hidden">
            <div class="error-icon">âš ï¸</div>
            <h3>Erreur</h3>
            <p id="errorMessage"></p>
            <button id="retryBtn" class="btn btn-secondary">RÃ©essayer</button>
        </section>

        <!-- Result State -->
        <section id="result" class="result hidden">
            <!-- Intention dÃ©tectÃ©e -->
            <div class="intention-badge">
                <span class="badge" id="intentionBadge"></span>
            </div>

            <!-- Score de confiance -->
            <div class="confidence-bar">
                <label>Confiance:</label>
                <div class="bar">
                    <div class="fill" id="confidenceFill"></div>
                </div>
                <span id="confidenceText">0%</span>
            </div>

            <!-- RÃ©ponse gÃ©nÃ©rÃ©e -->
            <div class="response-container">
                <label>RÃ©ponse suggÃ©rÃ©e:</label>
                <textarea 
                    id="responseText" 
                    rows="12"
                    placeholder="La rÃ©ponse gÃ©nÃ©rÃ©e apparaÃ®tra ici..."
                ></textarea>
                <div class="char-count">
                    <span id="charCount">0</span> caractÃ¨res
                </div>
            </div>

            <!-- Sources -->
            <div class="sources-container">
                <details>
                    <summary>ğŸ“š Sources utilisÃ©es (<span id="sourceCount">0</span>)</summary>
                    <ul id="sourcesList" class="sources-list"></ul>
                </details>
            </div>

            <!-- Actions -->
            <div class="actions">
                <button id="regenerateBtn" class="btn btn-secondary">
                    ğŸ”„ RÃ©gÃ©nÃ©rer
                </button>
                <button id="copyBtn" class="btn btn-secondary">
                    ğŸ“‹ Copier
                </button>
                <button id="insertBtn" class="btn btn-primary">
                    ğŸ“¤ Utiliser cette rÃ©ponse
                </button>
            </div>

            <!-- Stats -->
            <div class="stats">
                <small>â±ï¸ GÃ©nÃ©rÃ© en <span id="processingTime">0</span>s</small>
            </div>
        </section>

        <!-- Main Action -->
        <div class="main-action">
            <button id="generateBtn" class="btn btn-primary btn-large">
                âœ¨ GÃ©nÃ©rer une rÃ©ponse IA
            </button>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <small>PropulsÃ© par Llama 3.2 ğŸ¦™</small>
        </footer>
    </div>

    <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
    <script src="taskpane.js"></script>
</body>
</html>

2. taskpane.css :
Design moderne avec :
- Variables CSS pour les couleurs
- Dark mode support
- Animations fluides
- Responsive design
- Ã‰tats : default, loading, success, error
Palette de couleurs :
--primary: #0078d4 (bleu Microsoft)
--success: #10b981
--warning: #f59e0b
--error: #ef4444
--background: #ffffff
--surface: #f5f5f5
--text-primary: #1f2937
--text-secondary: #6b7280

3. taskpane.js :
CrÃ©er une classe AIEmailAssistant avec :

class AIEmailAssistant {
    constructor() {
        this.apiUrl = 'http://YOUR_SERVER_IP:3000/api';
        this.currentEmail = null;
        this.generatedResponse = null;
        this.init();
    }

    init() {
        Office.onReady((info) => {
            if (info.host === Office.HostType.Outlook) {
                this.setupEventListeners();
                this.loadEmailInfo();
            }
        });
    }

    setupEventListeners() {
        // Bouton gÃ©nÃ©ration
        // Bouton insertion
        // Bouton copie
        // Bouton rÃ©gÃ©nÃ©ration
    }

    async loadEmailInfo() {
        // RÃ©cupÃ©rer from, subject, body avec Office.js
    }

    async generateResponse() {
        // Appeler API backend
        // GÃ©rer les Ã©tats : loading, success, error
        // Animer les Ã©tapes de progression
    }

    async insertResponse() {
        // InsÃ©rer dans l'Ã©diteur Outlook
        // Office.context.mailbox.item.body.setAsync()
    }

    showLoading(step) {
        // Animer les Ã©tapes
    }

    showResult(data) {
        // Afficher rÃ©sultat
    }

    showError(message) {
        // Afficher erreur
    }
}

// Initialisation
const assistant = new AIEmailAssistant();

4. manifest.xml :
Configure :
- Version: 1.0.0
- Display name: "Assistant IA Email"
- Description
- Permissions: ReadWriteItem, ReadWriteMailbox
- Bouton dans le ruban : "RÃ©ponse IA"
- IcÃ´nes (16x16, 32x32, 80x80)
- URL du taskpane (pour test local : https://localhost:3000)

5. services/api.service.js :
class APIService {
    async generateResponse(email) {
        const response = await fetch(`${API_URL}/generate-response`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(email)
        });
        
        if (!response.ok) throw new Error('API Error');
        return await response.json();
    }
}

6. services/outlook.service.js :
class OutlookService {
    getEmailContent() {
        return new Promise((resolve) => {
            Office.context.mailbox.item.from.getAsync((result) => {
                const from = result.value.emailAddress;
                // ... rÃ©cupÃ©rer subject et body
                resolve({ from, subject, body });
            });
        });
    }

    insertResponse(text) {
        Office.context.mailbox.item.displayReplyForm({
            htmlBody: text
        });
    }
}

GÃ©nÃ¨re tous les fichiers avec :
- Code propre et commentÃ©
- Gestion d'erreurs complÃ¨te
- UX fluide avec animations
- Design moderne et professionnel
Fichiers attendus : Toute la structure Add-in complÃ¨te

ğŸ“¦ PARTIE 5 : CONFIGURATION NGINX (Reverse Proxy)
Prompt pour Claude Code :
TÃ‚CHE 5 : CrÃ©e la configuration Nginx pour exposer le backend de maniÃ¨re sÃ©curisÃ©e.

FICHIER : /etc/nginx/sites-available/outlook-ai-assistant

Configuration requise :
1. Reverse proxy vers localhost:3000
2. SSL/TLS avec certificat auto-signÃ© (pour test interne)
3. Rate limiting (100 requÃªtes/minute par IP)
4. CORS configurÃ© pour Outlook Add-in
5. Logs dÃ©taillÃ©s
6. Compression gzip
7. Headers de sÃ©curitÃ© (X-Frame-Options, CSP, etc.)

Domaine : ai-assistant.votre-entreprise.local (Ã  adapter)

Ajoute aussi un script nginx-setup.sh pour :
- CrÃ©er le certificat SSL auto-signÃ©
- Activer la configuration
- RedÃ©marrer Nginx
Fichiers attendus :

Configuration Nginx
Script nginx-setup.sh


ğŸ“¦ PARTIE 6 : SCRIPTS DE DÃ‰PLOIEMENT ET GESTION
Prompt pour Claude Code :
TÃ‚CHE 6 : CrÃ©e les scripts de gestion du serveur.

1. deploy.sh :
   - ArrÃªter le serveur existant
   - Faire un backup de la base de donnÃ©es
   - Copier les nouveaux fichiers
   - Installer les dÃ©pendances (npm install)
   - RedÃ©marrer avec PM2
   - VÃ©rifier que le service tourne

2. backup.sh :
   - Backup PostgreSQL (dump)
   - Backup Qdrant (snapshots)
   - Backup des documents (/data/knowledge-base)
   - Archiver avec timestamp
   - Garder les 30 derniers backups

3. health-check.sh :
   - VÃ©rifier que Ollama rÃ©pond (curl localhost:11434)
   - VÃ©rifier que Qdrant rÃ©pond (curl localhost:6333)
   - VÃ©rifier que PostgreSQL rÃ©pond (psql)
   - VÃ©rifier que le backend rÃ©pond (curl localhost:3000/api/health)
   - Afficher un rapport

4. logs-viewer.sh :
   - Menu interactif pour voir :
     a) Logs backend (PM2)
     b) Logs Nginx
     c) Logs PostgreSQL
     d) Logs Ollama

5. ecosystem.config.js (PM2) :
module.exports = {
  apps: [{
    name: 'outlook-ai-backend',
    script: './src/server.js',
    instances: 2,
    exec_mode: 'cluster',
    env: {
      NODE_ENV: 'production'
    },
    error_file: '/opt/outlook-ai-assistant/logs/error.log',
    out_file: '/opt/outlook-ai-assistant/logs/out.log',
    log_date_format: 'YYYY-MM-DD HH:mm:ss Z',
    merge_logs: true,
    max_memory_restart: '1G',
    autorestart: true
  }]
};

Tous les scripts doivent Ãªtre dans /opt/outlook-ai-assistant/scripts/
Fichiers attendus :

deploy.sh
backup.sh
health-check.sh
logs-viewer.sh
ecosystem.config.js


ğŸ“¦ PARTIE 7 : TESTS ET DOCUMENTATION
Prompt pour Claude Code :
TÃ‚CHE 7 : CrÃ©e les tests et la documentation.

1. Tests unitaires (Jest) :
   tests/unit/services/rag.service.test.js
   tests/unit/services/llm.service.test.js
   tests/unit/services/embedding.service.test.js
   
   Pour chaque service :
   - Tester les fonctions principales
   - Mocker les dÃ©pendances externes (Ollama, Qdrant)
   - VÃ©rifier la gestion d'erreurs

2. Tests d'intÃ©gration :
   tests/integration/email.routes.test.js
   
   Tester l'endpoint complet avec Supertest :
   - POST /api/generate-response avec un email valide
   - VÃ©rifier le format de la rÃ©ponse
   - Tester les cas d'erreur

3. README.md complet :
   - Description du projet
   - Architecture
   - PrÃ©requis
   - Installation pas Ã  pas
   - Configuration
   - Utilisation
   - FAQ
   - Troubleshooting
   - License

4. docs/API.md :
   Documentation complÃ¨te de l'API :
   - Liste des endpoints
   - ParamÃ¨tres d'entrÃ©e
   - Exemples de rÃ©ponses
   - Codes d'erreur

5. docs/DEPLOYMENT.md :
   Guide de dÃ©ploiement en production :
   - Configuration serveur
   - Installation des dÃ©pendances
   - SÃ©curitÃ©
   - Monitoring
   - Mise Ã  jour

6. docs/ADD-IN-INSTALLATION.md :
   Guide d'installation de l'Add-in :
   - Sideloading dans Outlook Desktop
   - Sideloading dans Outlook Web
   - DÃ©ploiement organisationnel

GÃ©nÃ¨re des docs claires avec des exemples concrets.
Fichiers attendus :

Tests complets
Documentation complÃ¨te


ğŸ“¦ PARTIE 8 : SCRIPT D'INSTALLATION TOUT-EN-UN
Prompt pour Claude Code :
TÃ‚CHE 8 : CrÃ©e un script d'installation automatique complet.

FICHIER : quick-install.sh

Ce script doit permettre une installation en une seule commande :
sudo bash quick-install.sh

Ã‰tapes :
1. Afficher un banner ASCII art "Outlook AI Assistant"
2. VÃ©rifier les prÃ©requis systÃ¨me (Ubuntu 22.04, 16GB RAM, 50GB disque)
3. Demander confirmation Ã  l'utilisateur
4. Installer toutes les dÃ©pendances (voir TÃ‚CHE 1)
5. Cloner ou crÃ©er la structure de projet
6. Configurer les fichiers .env (demander interactivement les valeurs)
7. Initialiser PostgreSQL (crÃ©er DB et user)
8. DÃ©marrer Qdrant
9. TÃ©lÃ©charger le modÃ¨le Ollama
10. Installer les dÃ©pendances Node.js
11. Configurer Nginx
12. DÃ©marrer le backend avec PM2
13. Afficher un rÃ©sumÃ© :
    - URL du backend
    - Status des services
    - Prochaines Ã©tapes

Ajouter une barre de progression pour chaque Ã©tape.
GÃ©rer les erreurs et permettre de reprendre en cas d'Ã©chec.
Fichier attendu : quick-install.sh (script ultime)

ğŸš€ PARTIE 9 : MISE EN PRODUCTION
Guide de dÃ©ploiement (Instructions manuelles)
Ã‰tape 1 : PrÃ©parer le serveur
bash# Sur le serveur de l'entreprise (SSH)
cd /opt
sudo git clone <votre-repo> outlook-ai-assistant
cd outlook-ai-assistant
sudo bash quick-install.sh
Ã‰tape 2 : Indexer la base de connaissances
bash# Copier vos documents
sudo cp /chemin/vers/documents/*.pdf /opt/outlook-ai-assistant/data/knowledge-base/

# Indexer
cd /opt/outlook-ai-assistant/backend
node src/scripts/index-documents.js
Ã‰tape 3 : VÃ©rifier que tout fonctionne
bashbash /opt/outlook-ai-assistant/scripts/health-check.sh
```

#### **Ã‰tape 4 : Configurer le DNS interne**
Ajouter dans le DNS de l'entreprise :
```
ai-assistant.votre-entreprise.local â†’ IP_DU_SERVEUR
Ã‰tape 5 : Installer l'Add-in sur votre Outlook
Pour Outlook Desktop :

Ouvrir Outlook
Aller dans Fichier â†’ Obtenir des complÃ©ments
Cliquer sur Mes complÃ©ments
En bas : **Ajouter un complÃ©ment personnalisÃ©
RÃ©essayerCette rÃ©ponse a Ã©tÃ© interrompue car Claude a atteint sa longueur maximale de message. Cliquez sur continuer pour permettre Ã  Claude de poursuivre.ContinuerClaude peut faire des erreurs. Assurez-vous de vÃ©rifier ses rÃ©ponses. Sonnet 4.5